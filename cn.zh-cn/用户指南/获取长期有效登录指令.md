# 获取长期有效登录指令<a name="swr_01_1000"></a>

## 操作场景<a name="section139621122486"></a>

本章节介绍如何获取长期有效的登录指令，长期有效登录指令的有效期为永久。

>![](public_sys-resources/icon-note.gif) **说明：** 
>为保证安全，获取登录指令过程建议在开发环境执行。

## 前提条件<a name="section1829411279116"></a>

请确保已具有编程访问权限。获取方式参考[步骤1](#li122491614174210)。

## 操作步骤<a name="section140815918599"></a>

1.  <a name="li122491614174210"></a>获取编程访问权限。
    1.  以管理员身份，登录IAM管理控制台。
    2.  在“用户“页搜索框输入要授予编程访问权限的用户名称。

        **图 1**  用户列表<a name="fig11244685518"></a>  
        ![](figures/用户列表.png "用户列表")

    3.  单击用户名称，进入用户详情页。

        **图 2**  用户详情页<a name="fig10221724175117"></a>  
        ![](figures/用户详情页.png "用户详情页")

    4.  单击“访问方式“后面的![](figures/icon-编辑.png)按钮，修改访问方式。
    5.  勾选“编程访问“选项。

        **图 3**  修改访问方式<a name="fig187211422111"></a>  
        ![](figures/修改访问方式.png "修改访问方式")

2.  <a name="li5768123671815"></a>获取区域项目名称、镜像仓库地址。
    1.  登录管理控制台。
    2.  在管理控制台左上角单击![](figures/icon-区域.png)，选择区域和项目。
    3.  单击左侧导航栏![](figures/icon-列表.png)，选择“管理与监督”\>“统一身份认证服务IAM”。
    4.  将鼠标移至页面右上角用户名称上。

        **图 4**  IAM首页<a name="fig1956964763114"></a>  
        ![](figures/IAM首页.png "IAM首页")

    5.  单击“我的凭证“。
    6.  在项目列表中找到所属区域及项目：

        如下图所示，“华北-北京四“对应的项目名称为“cn-north-4“。

        **图 5**  区域与项目<a name="fig1548146070"></a>  
        ![](figures/区域与项目.png "区域与项目")

    7.  您可以按照获取到的项目信息拼接镜像仓库地址，拼接方式为 : swr.区域项目名称.myhuaweicloud.com

        如华北-北京四对应的镜像仓库地址为：swr.cn-north-4.myhuaweicloud.com。

3.  <a name="li1863783911295"></a>获取AK/SK访问密钥。

    >![](public_sys-resources/icon-note.gif) **说明：** 
    >访问密钥即AK/SK（Access Key ID/Secret Access Key），表示一组密钥对，用于验证调用API发起请求的访问者身份，与密码的功能相似。如果您已有AK/SK，可以直接使用，无需再次获取。

    1.  登录IAM管理控制台，将鼠标移到用户名处，单击“我的凭证“。
    2.  在左侧导航栏中选择“访问密钥“，单击“新增访问密钥“。
    3.  输入描述信息，单击“确定“。
    4.  在弹出的提示页面单击“立即下载“。

        下载成功后，在“credentials“文件中即可获取AK和SK信息。

        >![](public_sys-resources/icon-note.gif) **说明：** 
        >为防止访问密钥泄露，建议您将其保存到安全的位置。


4.  <a name="li132430753010"></a>登录一台Linux系统的计算机，执行如下命令获取登录密钥。

    **printf "_$AK_" | openssl dgst -binary -sha256 -hmac "_$SK_" | od -An -vtx1 | sed 's/\[ \\n\]//g' | sed 'N;s/\\n//'**

    其中$AK和$SK为[3](#li1863783911295)获取的AK/SK。

    **图 6**  示例<a name="fig56444333813"></a>  
    ![](figures/示例.png "示例")

5.  使用如下的格式拼接登录指令。

    **docker login -u**  \[区域项目名称\]**@**\[AK\]  **-p**  \[登录密钥\] \[镜像仓库地址\]

    其中，区域项目名称和镜像仓库地址在[2](#li5768123671815)中获取，AK在[3](#li1863783911295)中获取，登录密钥为[4](#li132430753010)的执行结果。

    示例：

    **docker login -u cn-north-4@**_CCXXXXX_ **-p** _96xxxxx_ **swr.cn-north-4.myhuaweicloud.com**

    **图 7**  使用长期登录指令连接SWR<a name="fig9655181252519"></a>  
    ![](figures/使用长期登录指令连接SWR.png "使用长期登录指令连接SWR")

    >![](public_sys-resources/icon-note.gif) **说明：** 
    >-   登录密钥字符串是经过加密的，无法逆向解密，从-p无法获取到SK。
    >-   获取的登录指令可在其他机器上使用并登录。

6.  当您退出仓库时，请使用以下命令删除您的认证信息。

    ```
    cd /root/.docker/
    rm -f config.json
    ```

7.  使用**history -c**命令清理相关使用痕迹，避免隐私信息泄露。

